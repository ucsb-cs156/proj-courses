<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CoursePage.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">courses</a> &gt; <a href="index.source.html" class="el_package">edu.ucsb.cs156.courses.documents</a> &gt; <span class="el_source">CoursePage.java</span></div><h1>CoursePage.java</h1><pre class="source lang-java linenums">package edu.ucsb.cs156.courses.documents;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.ObjectMapper;
import java.util.ArrayList;
import java.util.List;
import lombok.Data;
import lombok.NoArgsConstructor;
import lombok.extern.slf4j.Slf4j;

@Data
@NoArgsConstructor
<span class="fc" id="L14">@Slf4j</span>
public class CoursePage {
  private int pageNumber;
  private int pageSize;
  private int total;
  private List&lt;Course&gt; classes;

  /**
   * Create a CoursePage object from json representation
   *
   * @param json String of json returned by API endpoint {@code /classes/search}
   * @return a new CoursePage object
   * @see &lt;a href=
   *     &quot;https://developer.ucsb.edu/content/academic-curriculums&quot;&gt;https://developer.ucsb.edu/content/academic-curriculums&lt;/a&gt;
   */
  public static CoursePage fromJSON(String json) {
    try {
<span class="fc" id="L31">      ObjectMapper objectMapper = new ObjectMapper();</span>
<span class="fc" id="L32">      objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);</span>

<span class="fc" id="L34">      CoursePage coursePage = objectMapper.readValue(json, CoursePage.class);</span>
<span class="fc" id="L35">      return coursePage;</span>
<span class="fc" id="L36">    } catch (JsonProcessingException jpe) {</span>
<span class="fc" id="L37">      log.error(&quot;JsonProcessingException:&quot; + jpe);</span>
<span class="fc" id="L38">      return null;</span>
    }
  }

  /**
   * Create a List of ConvertedSections from json representation
   *
   * @return a list of converted sections
   */
  public List&lt;ConvertedSection&gt; convertedSections() {

<span class="fc" id="L49">    List&lt;ConvertedSection&gt; result = new ArrayList&lt;ConvertedSection&gt;();</span>

<span class="fc bfc" id="L51" title="All 2 branches covered.">    for (Course c : this.getClasses()) {</span>
<span class="fc bfc" id="L52" title="All 2 branches covered.">      for (Section section : c.getClassSections()) {</span>
<span class="fc" id="L53">        int lectureNum = Integer.parseInt(section.getSection()) / 100;</span>

        CourseInfo courseInfo =
<span class="fc" id="L56">            CourseInfo.builder()</span>
<span class="fc" id="L57">                .quarter(c.getQuarter())</span>
<span class="fc" id="L58">                .courseId(c.getCourseId() + &quot;-&quot; + Integer.toString(lectureNum))</span>
<span class="fc" id="L59">                .title(c.getTitle())</span>
<span class="fc" id="L60">                .description(c.getDescription())</span>
<span class="fc" id="L61">                .generalEducation(c.getGeneralEducation())</span>
<span class="fc" id="L62">                .build();</span>
        ConvertedSection cs =
<span class="fc" id="L64">            ConvertedSection.builder().courseInfo(courseInfo).section(section).build();</span>
<span class="fc" id="L65">        result.add(cs);</span>
<span class="fc" id="L66">      }</span>
<span class="fc" id="L67">    }</span>
<span class="fc" id="L68">    return result;</span>
  }

  /**
   * Look ahead to the next section if there is one
   *
   * @param sections List of sections
   * @param sectionIndex the index of the current section
   * @return the next section if it exists, otherwise null
   */
  public Section nextSection(List&lt;Section&gt; sections, int sectionIndex) {
<span class="fc bfc" id="L79" title="All 2 branches covered.">    if (sectionIndex + 1 &lt; sections.size()) {</span>
<span class="fc" id="L80">      return sections.get(sectionIndex + 1);</span>
    }
<span class="fc" id="L82">    return null; // No more sections to look at</span>
  }

  /**
   * Given a Course, return a list of Primary objects.
   *
   * &lt;p&gt;The reason this is necessary is that the UCSB API returns a course with a list of sections.
   * However, that list of sections may contain multiple primary sections, each with its own set of
   * secondary sections.
   *
   * &lt;p&gt;This method processes the sections of a course to create a list of Primary objects, each
   * representing a primary section and its associated secondary sections.
   *
   * @return a list of Primary objects
   */
  List&lt;Primary&gt; getListOfPrimaries(Course course) {
<span class="fc" id="L98">    List&lt;Primary&gt; result = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L99">    List&lt;Section&gt; classSections = course.getClassSections();</span>

<span class="fc bfc" id="L101" title="All 2 branches covered.">    if (classSections.isEmpty()) {</span>
<span class="fc" id="L102">      return result; // No sections to process</span>
    }

<span class="fc" id="L105">    Section firstSection = classSections.get(0);</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">    if (!firstSection.isPrimary()) {</span>
<span class="fc" id="L107">      log.error(&quot;First section is not primary: {}&quot;, firstSection);</span>
<span class="fc" id="L108">      return result; // Skip if no primary section</span>
    }

<span class="fc" id="L111">    int sectionIndex = 0;</span>
<span class="fc" id="L112">    Section thisSection = classSections.get(sectionIndex);</span>

<span class="fc bfc" id="L114" title="All 2 branches covered.">    while (thisSection != null) {</span>
<span class="fc" id="L115">      List&lt;Section&gt; secondaries = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L116">      Section lookAhead = nextSection(classSections, sectionIndex);</span>

<span class="fc bfc" id="L118" title="All 4 branches covered.">      while (lookAhead != null &amp;&amp; !lookAhead.isPrimary()) {</span>
<span class="fc" id="L119">        secondaries.add(lookAhead);</span>
<span class="fc" id="L120">        sectionIndex++;</span>
<span class="fc" id="L121">        lookAhead = nextSection(classSections, sectionIndex);</span>
      }

      Primary primary =
<span class="fc" id="L125">          Primary.builder()</span>
<span class="fc" id="L126">              .quarter(course.getQuarter())</span>
<span class="fc" id="L127">              .courseId(course.getCourseId())</span>
<span class="fc" id="L128">              .title(course.getTitle())</span>
<span class="fc" id="L129">              .description(course.getDescription())</span>
<span class="fc" id="L130">              .primary(thisSection)</span>
<span class="fc" id="L131">              .secondaries(secondaries)</span>
<span class="fc" id="L132">              .generalEducation(course.getGeneralEducation())</span>
<span class="fc" id="L133">              .build();</span>
<span class="fc" id="L134">      result.add(primary);</span>
<span class="fc" id="L135">      thisSection = nextSection(classSections, sectionIndex);</span>
<span class="fc" id="L136">      sectionIndex++; // Move to the next section</span>
<span class="fc" id="L137">    }</span>
<span class="fc" id="L138">    return result;</span>
  }

  /** Get a list of Primary objects from the CoursePage */
  public List&lt;Primary&gt; getPrimaries() {
<span class="fc" id="L143">    List&lt;Primary&gt; result = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L145" title="All 2 branches covered.">    for (Course c : this.getClasses()) {</span>
<span class="fc" id="L146">      List&lt;Primary&gt; primaries = getListOfPrimaries(c);</span>
<span class="fc" id="L147">      result.addAll(primaries);</span>
<span class="fc" id="L148">    }</span>
<span class="fc" id="L149">    return result;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>